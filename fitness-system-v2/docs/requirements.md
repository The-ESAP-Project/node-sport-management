# 学生体测管理系统 v2.0 需求文档

## 项目概述
重写版学生体测管理系统，支持按班级录入体测数据，自动计算分数，提供多维度数据分析。

## 技术栈
- **前端**: Vue3 + Vite + Element Plus + ECharts
- **后端**: Node.js + Express + Sequelize 
- **数据库**: PostgreSQL + Redis
- **文件处理**: ExcelJS

## 功能模块

### 1. 用户认证模块
#### 用户角色
- **超级管理员**: 体育老师共用账号，管理系统配置、评分标准、查看所有数据
- **班级账号**: 格式 `年级-班级名` (如: 2023-高三一班)，只能管理本班数据

#### 权限设计
- 班级账号: 录入本班数据、查看本班统计
- 超级管理员: 系统配置、评分标准管理、全局数据查看

### 2. 学生信息管理模块
#### 体测项目 (9项)
**通用项目**: 身高(cm)、体重(kg)、肺活量(ml)、50米跑(s)、立定跳远(m)、坐位体前屈(cm)
**性别差异项目**:
- 男生: 1000米跑(s)、引体向上(次)
- 女生: 800米跑(s)、1分钟仰卧起坐(次)

#### 数据录入流程
1. **Excel模板下载**: 系统提供标准Excel模板
2. **数据上传**: 班级账号上传填写完整的Excel文件
3. **预览确认**: 数据暂存Redis，显示解析结果和校验信息
4. **正式录入**: 确认无误后保存到PostgreSQL
5. **数据校验**: 检查班级人数完整性、数据格式正确性

#### Excel格式要求
```
列名: 姓名 | 性别 | 班级 | 身高 | 体重 | 肺活量 | 50米跑 | 立定跳远 | 坐位体前屈 | 长跑 | 力量项目
说明: 长跑(男1000m/女800m) | 力量项目(男引体向上/女仰卧起坐)
```

### 3. 评分标准管理模块
#### 标准结构
- **项目**: 9个体测项目
- **性别**: 男/女分别配置
- **分数区间**: 支持多个区间段配置
- **权重**: 各项目权重，总和必须100%
- **方向**: higher_better(越高越好) / lower_better(越低越好)

#### 默认标准
系统预置国家标准作为默认模板，管理员可基于此修改

#### 计算规则
```
单项分数 = 根据原始值匹配对应区间的分数
总分 = Σ(单项分数 × 权重)
```

### 4. 数据分析模块
#### 分析维度
- **个人**: 学生个人三年历史趋势
- **班级**: 班级内统计分析和三年对比
- **年级**: 年级整体分析和历年对比  
- **全校**: 全校数据统计和历史趋势

#### 图表类型
- **雷达图**: 个人各项目能力展示
- **柱状图**: 班级/年级分数分布
- **折线图**: 历年趋势对比
- **排名表**: 各维度排名列表

### 5. 数据导出模块
- **Excel导出**: 支持按班级、年级、全校导出
- **报表格式**: 包含原始数据、计算分数、排名信息
- **导出权限**: 管理员可导出所有数据，班级账号只能导出本班

### 6. 系统配置模块
- **全局录入截止时间**: 过期后禁止数据录入
- **评分标准版本管理**: 支持标准修改和历史版本
- **数据重算**: 标准修改后自动重新计算所有相关数据

## 数据流程

### 录入流程
```
班级登录 → 下载Excel模板 → 填写学生数据 → 上传Excel → 系统解析 → 预览确认 → 保存入库 → 自动计算分数
```

### 分析流程  
```
选择分析维度 → 设置筛选条件 → 系统计算统计数据 → 生成图表 → 展示结果
```

## 技术要求

### 性能要求
- 支持单班级50人数据批量录入
- 分析接口响应时间 < 500ms
- 支持同时10个班级并发操作

### 数据要求
- Redis预览数据保留1小时
- 支持数据修改和重新上传
- 所有操作需要审计日志

### 安全要求
- JWT认证机制
- 接口权限校验
- 数据访问隔离